import{k as I,t as M,l as _,o as d}from"./index-BAOXlGCN.js";const D=I(M);var me=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),S="%[a-f0-9]{2}",f=new RegExp("("+S+")|([^%]+?)","gi"),p=new RegExp("("+S+")+","gi");function u(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var n=t.slice(0,e),r=t.slice(e);return Array.prototype.concat.call([],u(n),u(r))}function U(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(f)||[],n=1;n<e.length;n++)t=u(e,n).join(""),e=t.match(f)||[];return t}}function $(t){for(var e={"%FE%FF":"��","%FF%FE":"��"},n=p.exec(t);n;){try{e[n[0]]=decodeURIComponent(n[0])}catch{var r=U(n[0]);r!==n[0]&&(e[n[0]]=r)}n=p.exec(t)}e["%C2"]="�";for(var s=Object.keys(e),o=0;o<s.length;o++){var l=s[o];t=t.replace(new RegExp(l,"g"),e[l])}return t}var we=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return $(t)}},be=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const n=t.indexOf(e);return n===-1?[t]:[t.slice(0,n),t.slice(n+e.length)]};const B=t=>JSON.stringify(t,(e,n)=>typeof n=="bigint"?n.toString()+"n":n),J=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,n=t.replace(e,'$1"$2n"$3');return JSON.parse(n,(r,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function q(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return J(t)}catch{return t}}function g(t){return typeof t=="string"?t:B(t)||""}const H="PARSE_ERROR",V="INVALID_REQUEST",k="METHOD_NOT_FOUND",W="INVALID_PARAMS",T="INTERNAL_ERROR",h="SERVER_ERROR",G=[-32700,-32600,-32601,-32602,-32603],a={[H]:{code:-32700,message:"Parse error"},[V]:{code:-32600,message:"Invalid Request"},[k]:{code:-32601,message:"Method not found"},[W]:{code:-32602,message:"Invalid params"},[T]:{code:-32603,message:"Internal error"},[h]:{code:-32e3,message:"Server error"}},j=h;function Q(t){return G.includes(t)}function v(t){return Object.keys(a).includes(t)?a[t]:a[j]}function X(t){const e=Object.values(a).find(n=>n.code===t);return e||a[j]}function z(t,e,n){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${e}`):t}var K={},i={},y;function Y(){if(y)return i;y=1,Object.defineProperty(i,"__esModule",{value:!0}),i.isBrowserCryptoAvailable=i.getSubtleCrypto=i.getBrowerCrypto=void 0;function t(){return(globalThis==null?void 0:globalThis.crypto)||(globalThis==null?void 0:globalThis.msCrypto)||{}}i.getBrowerCrypto=t;function e(){const r=t();return r.subtle||r.webkitSubtle}i.getSubtleCrypto=e;function n(){return!!t()&&!!e()}return i.isBrowserCryptoAvailable=n,i}var c={},E;function Z(){if(E)return c;E=1,Object.defineProperty(c,"__esModule",{value:!0}),c.isBrowser=c.isNode=c.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}c.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}c.isNode=e;function n(){return!t()&&!e()}return c.isBrowser=n,c}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=D;e.__exportStar(Y(),t),e.__exportStar(Z(),t)})(K);function A(t=3){const e=Date.now()*Math.pow(10,t),n=Math.floor(Math.random()*Math.pow(10,t));return e+n}function ee(t=6){return BigInt(A(t))}function te(t,e,n){return{id:n||A(),jsonrpc:"2.0",method:t,params:e}}function Ce(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ne(t,e,n){return{id:t,jsonrpc:"2.0",error:re(e,n)}}function re(t,e){return typeof t>"u"?v(T):(typeof t=="string"&&(t=Object.assign(Object.assign({},v(h)),{message:t})),typeof e<"u"&&(t.data=e),Q(t.code)&&(t=X(t.code)),t)}class F{}let Oe=class extends F{constructor(e){super()}};class se extends F{constructor(){super()}}class oe extends se{constructor(e){super()}}const ie="^https?:",ce="^wss?:";function ae(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function N(t,e){const n=ae(t);return typeof n>"u"?!1:new RegExp(e).test(n)}function R(t){return N(t,ie)}function _e(t){return N(t,ce)}function Se(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function x(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Te(t){return x(t)&&"method"in t}function ue(t){return x(t)&&(he(t)||L(t))}function he(t){return"result"in t}function L(t){return"error"in t}class je extends oe{constructor(e){super(e),this.events=new _.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async request(e,n){return this.requestStrict(te(e.method,e.params||[],e.id||ee().toString()),n)}async requestStrict(e,n){return new Promise(async(r,s)=>{if(!this.connection.connected)try{await this.open()}catch(o){s(o)}this.events.on(`${e.id}`,o=>{L(o)?s(o.error):r(o.result)});try{await this.connection.send(e,n)}catch(o){s(o)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ue(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}var le=Object.defineProperty,de=Object.defineProperties,fe=Object.getOwnPropertyDescriptors,m=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,ge=Object.prototype.propertyIsEnumerable,w=(t,e,n)=>e in t?le(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,b=(t,e)=>{for(var n in e||(e={}))pe.call(e,n)&&w(t,n,e[n]);if(m)for(var n of m(e))ge.call(e,n)&&w(t,n,e[n]);return t},C=(t,e)=>de(t,fe(e));const ve={Accept:"application/json","Content-Type":"application/json"},ye="POST",O={headers:ve,method:ye},P=10;class Ae{constructor(e,n=!1){if(this.url=e,this.disableProviderPing=n,this.events=new _.EventEmitter,this.isAvailable=!1,this.registering=!1,!R(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=n}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,n){this.events.on(e,n)}once(e,n){this.events.once(e,n)}off(e,n){this.events.off(e,n)}removeListener(e,n){this.events.removeListener(e,n)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const n=g(e),r=await(await d(this.url,C(b({},O),{body:n}))).json();this.onPayload({data:r})}catch(n){this.onError(e.id,n)}}async register(e=this.url){if(!R(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const n=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=n||this.events.listenerCount("open")>=n)&&this.events.setMaxListeners(n+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));r()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const n=g({id:1,jsonrpc:"2.0",method:"test",params:[]});await d(e,C(b({},O),{body:n}))}this.onOpen()}catch(n){const r=this.parseError(n);throw this.events.emit("register_error",r),this.onClose(),r}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const n=typeof e.data=="string"?q(e.data):e.data;this.events.emit("payload",n)}onError(e,n){const r=this.parseError(n),s=r.message||r.toString(),o=ne(e,s);this.events.emit("payload",o)}parseError(e,n=this.url){return z(e,n,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>P&&this.events.setMaxListeners(P)}}export{me as a,je as b,K as c,we as d,Ae as e,ne as f,q as g,g as h,_e as i,Se as j,z as k,L as l,te as m,ee as n,Oe as o,A as p,Te as q,D as r,be as s,ue as t,Ce as u,he as v};
